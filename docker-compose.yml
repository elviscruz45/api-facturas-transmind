services:
  api-facturas:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: api-facturas
    ports:
      - "8080:8080" # Cambiar a 8080

    # Load environment variables from .env file
    env_file:
      - .env

    environment:
      # Google Cloud Configuration
      - GOOGLE_CLOUD_PROJECT=${GOOGLE_CLOUD_PROJECT}
      - GOOGLE_APPLICATION_CREDENTIALS=/app/credentials/service-account.json

      # API Configuration
      - DEBUG=${DEBUG:-false}
      - MAX_FILE_SIZE_MB=${MAX_FILE_SIZE_MB:-300}

      # Gemini Configuration
      - GEMINI_MODEL=${GEMINI_MODEL:-gemini-2.5-flash-lite}
      - GEMINI_LOCATION=${GEMINI_LOCATION:-us-central1}
      - GEMINI_CONCURRENCY_LIMIT=${GEMINI_CONCURRENCY_LIMIT:-5}
      - GEMINI_TIMEOUT_SECONDS=${GEMINI_TIMEOUT_SECONDS:-30}
      - PORT=8080 # AÃ±adir PORT

    # Mount credentials file for local development
    volumes:
      - ./facturacion-484614-c2985e715326.json:/app/credentials/service-account.json:ro

    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8080/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 10s

    restart: unless-stopped

    # Resource limits (adjust based on your needs)
    deploy:
      resources:
        limits:
          cpus: "2"
          memory: 2G
        reservations:
          cpus: "0.5"
          memory: 512M

networks:
  default:
    name: api-facturas-network
